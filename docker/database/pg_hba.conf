# ================================
# PostgreSQL Host-Based Authentication Configuration
# ================================
# Production-hardened authentication settings for SightEdit

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             postgres        ::1/128                 scram-sha-256

# Production application connections (SSL required)
hostssl sightedit_production    sightedit_app      10.0.0.0/8          scram-sha-256
hostssl sightedit_production    sightedit_app      172.16.0.0/12       scram-sha-256
hostssl sightedit_production    sightedit_app      192.168.0.0/16      scram-sha-256

# Read-only user connections
hostssl sightedit_production    sightedit_readonly 10.0.0.0/8          scram-sha-256
hostssl sightedit_production    sightedit_readonly 172.16.0.0/12       scram-sha-256
hostssl sightedit_production    sightedit_readonly 192.168.0.0/16      scram-sha-256

# Backup user connections (from specific backup server)
hostssl all                     sightedit_backup   10.0.1.100/32       scram-sha-256

# Replication connections
hostssl replication             sightedit_replica  10.0.1.0/24         scram-sha-256

# Monitoring connections
hostssl all                     sightedit_monitor  10.0.0.0/8          scram-sha-256

# Staging environment connections (less strict SSL requirements)
host    sightedit_staging       sightedit_staging  10.0.2.0/24         scram-sha-256

# Development environment (local only, for development containers)
host    sightedit_dev          sightedit_dev      172.18.0.0/16       trust

# Deny all other connections
host    all                     all                0.0.0.0/0           reject
host    all                     all                ::/0                reject